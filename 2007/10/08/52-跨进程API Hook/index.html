<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="From to Earth - å°äº‹æˆå°±å¤§äº‹,ç»†èŠ‚æˆå°±å®Œç¾"><title>è·¨è¿›ç¨‹API Hook | From to Earth</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=UA-14722977-1" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-14722977-1');
</script><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">è·¨è¿›ç¨‹API Hook</h1><a id="logo" href="/.">From to Earth</a><p class="description">å°äº‹æˆå°±å¤§äº‹,ç»†èŠ‚æˆå°±å®Œç¾</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">è·¨è¿›ç¨‹API Hook</h1><div class="post-meta">2007-10-08<span> | </span><span class="category"><a href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/">è½¯ä»¶æŠ€æœ¯</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 7.1k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 36</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="post-content"><p>è·¨è¿›ç¨‹API&nbsp;Hookï¼ˆåˆç¨¿ï¼‰<br /><br />ä»€ä¹ˆæ˜¯&ldquo;è·¨è¿›ç¨‹&nbsp;API&nbsp;Hook&rdquo;ï¼Ÿ<br /></p>
<div class="left_6_1" id="w_hzh">&nbsp;</div>
ä¼—æ‰€å‘¨çŸ¥<a href="http://www.qqread.com/keys/windows/index.html" target="_blank">Windows</a>åº”ç”¨ç¨‹åºçš„å„ç§ç³»ç»ŸåŠŸèƒ½æ˜¯é€šè¿‡è°ƒç”¨APIå‡½æ•°æ¥å®ç°ã€‚API&nbsp;Hookå°±æ˜¯ç»™ç³»ç»Ÿçš„APIé™„åŠ ä¸Šä¸€æ®µå°ç¨‹åºï¼Œå®ƒèƒ½ç›‘è§†ç”šè‡³æ§åˆ¶åº”ç”¨ç¨‹åºå¯¹APIå‡½æ•°çš„è°ƒç”¨ã€‚æ‰€è°“è·¨è¿›ç¨‹ä¹Ÿå°±æ˜¯è®©è‡ªå·±çš„ç¨‹åºæ¥æ§åˆ¶åˆ«äººç¨‹åºçš„APIè°ƒç”¨äº†ã€‚<br /><br />API&nbsp;Hook&nbsp;ç†è®º<br />é€šè¿‡å¯¹Win32&nbsp;PEæ–‡ä»¶çš„åˆ†æ(å¦‚æœä½ è¿˜ä¸ç†Ÿæ‚‰PEæ–‡ä»¶æ ¼å¼ï¼Œå¯ä»¥çœ‹çœ‹Iczelionçš„PEæ•™ç¨‹æˆ–è€…LUEVELSMEYERçš„&lt;&gt;)ã€‚æˆ‘ä»¬çŸ¥é“åœ¨PEæ–‡ä»¶ä¸­çš„IMPORT&nbsp;TABLEå†…å­˜å‚¨ç€APIå‡½æ•°çš„å¾ˆå¤šä¿¡æ¯ã€‚å…¶ä¸­åŒ…æ‹¬APIçš„å‡½æ•°åï¼Œè°ƒç”¨åœ°å€ç­‰ç­‰ã€‚è€Œæ“ä½œç³»ç»Ÿåœ¨æ‰§è¡ŒPEæ–‡ä»¶æ—¶ä¼šå…ˆå°†å…¶æ˜ å°„åˆ°å†…å­˜ä¸­ã€‚åœ¨æ˜ å°„çš„åŒæ—¶è¿˜ä¼šæŠŠå½“å‰ç‰ˆæœ¬æ“ä½œç³»ç»Ÿä¸­APIå‡½æ•°çš„å…¥å£åœ°å€å†™å…¥IMPORT&nbsp;TABLEä¸­ä¸€ç»„ä¸APIè°ƒç”¨ç›¸å…³çš„ç»“æ„ä½“å†…ï¼Œç”¨äºè¯¥åº”ç”¨ç¨‹åºçš„APIè°ƒç”¨ã€‚&nbsp;å½“åº”ç”¨ç¨‹åºè°ƒç”¨APIæ—¶ï¼Œä»–ä¼šåœ¨è‡ªå·±å†…å­˜æ˜ åƒé‡Œå¯»æ‰¾APIçš„å…¥å£åœ°å€ï¼Œç„¶åæ‰§è¡ŒCALLæŒ‡ä»¤ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹åº”ç”¨ç¨‹åºå†…å­˜æ˜ åƒçš„IMPORT&nbsp;TABLEä¸­APIå‡½æ•°çš„å…¥å£åœ°å€ï¼Œå°±å¯ä»¥è¾¾åˆ°é‡å®šå‘APIçš„ç›®çš„ã€‚å°†APIåœ°å€æ”¹ä¸ºæˆ‘ä»¬è‡ªå·±å‡½æ•°çš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬çš„å‡½æ•°å°±å¯ä»¥å®Œæˆå¯¹APIçš„ç›‘è§†å’Œæ§åˆ¶äº†ã€‚<br /><br />API&nbsp;Hook&nbsp;çš„å®ç°<br />/*&nbsp;1&nbsp;*/HANDLE&nbsp;hCurrent&nbsp;=&nbsp;GetModuleHandle(NULL);<br />/*&nbsp;2&nbsp;*/IMAGE_DOS_HEADER&nbsp;*pidh;<br />/*&nbsp;3&nbsp;*/IMAGE_NT_HEADERS&nbsp;*pinh;<br />/*&nbsp;4&nbsp;*/IMAGE_DATA_DIRECTORY&nbsp;*pSymbolTable;<br />/*&nbsp;5&nbsp;*/IMAGE_IMPORT_DESCRIPTOR&nbsp;*piid;<br />&nbsp;<br />/*&nbsp;6&nbsp;*/pidh&nbsp;=&nbsp;(IMAGE_DOS_HEADER&nbsp;*)hCurrent;&nbsp;<br />/*&nbsp;7&nbsp;*/pinh&nbsp;=&nbsp;(IMAGE_NT_HEADERS&nbsp;*)((DWORD)hCurrent&nbsp;+&nbsp;pidh-&gt;e_lfanew);<br />/*&nbsp;8&nbsp;*/pSymbolTable&nbsp;=&nbsp;&amp;pinh-&gt;OptionalHeader.DataDirectory[1];<br />/*&nbsp;9&nbsp;*/piid&nbsp;=(IMAGE_IMPORT_DESCRIPTOR&nbsp;*)((DWORD)hCurrent&nbsp;+&nbsp;&nbsp;pSymbolTable-&gt;VirtualAddress);<br />/*10&nbsp;*/do&nbsp;{<br />/*11&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_THUNK_DATA&nbsp;*pitd,*pitd2;<br />/*12&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;pitd&nbsp;=&nbsp;(IMAGE_THUNK_DATA&nbsp;*)((DWORD)hCurrent&nbsp;+&nbsp;piid-&gt;OriginalFirstThunk);<br />/*13&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;pitd2&nbsp;=&nbsp;(IMAGE_THUNK_DATA&nbsp;*)((DWORD)hCurrent&nbsp;+&nbsp;piid-&gt;FirstThunk);<br />/*14&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{<br />/*15&nbsp;*/&nbsp;IMAGE_IMPORT_BY_NAME&nbsp;*piibn;<br />/*16&nbsp;*/&nbsp;piibn&nbsp;=&nbsp;(IMAGE_IMPORT_BY_NAME&nbsp;*)((DWORD)hCurrent&nbsp;+&nbsp;&nbsp;*((DWORD&nbsp;*)pitd));<br />/*17&nbsp;*/&nbsp;PROC&nbsp;*ppfn&nbsp;=&nbsp;(PROC&nbsp;*)(pitd2-&gt;u1.Function);<br />/*18&nbsp;*/&nbsp;if&nbsp;(!strcmp(&quot;MessageBoxW&quot;,(char&nbsp;*)piibn-&gt;Name))&nbsp;{<br />/*19&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;oldMsg&nbsp;=&nbsp;(MsgBoxType)(ppfn);<br />/*20&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;addr&nbsp;=&nbsp;(DWORD)MyMessage;<br />/*21&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;written&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;æ”¹å˜å†…å­˜è¯»å†™çŠ¶æ€&nbsp;*/<br />/*22&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;oldAccess;<br />/*23&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect(&amp;pitd2-&gt;u1.Function,sizeof(DWORD),PAGE_WRITECOPY,&amp;oldAccess);<br />/*24&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APIAddress&nbsp;=&nbsp;(DWORD)&amp;pitd2-&gt;u1.Function;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;å‘å†…å­˜æ˜ åƒå†™å…¥æ•°æ®&nbsp;*/<br />/*25&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory(GetCurrentProcess(),&amp;pitd2-&gt;u1.Function,&nbsp;&amp;addr,sizeof(DWORD),&nbsp;&amp;written);<br />/*26&nbsp;*/&nbsp;}<br />/*27&nbsp;*/&nbsp;pitd++;pitd2++;<br />/*28&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while&nbsp;(pitd-&gt;u1.Function);<br />&nbsp;<br />/*29&nbsp;*/&nbsp;&nbsp;&nbsp;&nbsp;piid++;<br />/*30&nbsp;*/}&nbsp;while&nbsp;(piid-&gt;FirstThunk&nbsp;+&nbsp;piid-&gt;Characteristics&nbsp;<br />&nbsp;&nbsp;+&nbsp;piid-&gt;ForwarderChain&nbsp;+&nbsp;piid-&gt;Name&nbsp;+&nbsp;piid-&gt;TimeDateStamp);<br />åˆ†æ:<br />å¯»è§…IMPORT&nbsp;TALBE<br />åœ¨/*1*/ä¸­æˆ‘ä»¬ä½¿ç”¨GetModuleHandle(NULL)æ¥è¿”å›å½“å‰è¿›ç¨‹åœ¨å†…å­˜ä¸­æ˜ åƒçš„åŸºåœ°å€ã€‚ä½†è¿™ä¸ªå€¼åœ¨æ–‡æ¡£ä¸­ä»…ä»…è¢«æè¿°ä¸º&quot;a&nbsp;module&nbsp;handle&nbsp;for&nbsp;the&nbsp;specified&nbsp;module&quot;ï¼Œè™½ç„¶ä»–ç¡®å®æ˜¯è¿›ç¨‹å†…å­˜æ˜ åƒçš„åŸºåœ°å€ã€‚å¦‚æœä½ ä¸å¤ªæ”¾å¿ƒçš„è¯ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼ŒGetModuleInformationå‡½æ•°æ¥è·å¾—åŸºåœ°å€ï¼Œåªä¸è¿‡ä½ è¦é¢å¤–åŒ…å«psapi.hå’Œpsapi.libäº†(è¿™ä¸ªåº“åœ¨VC6é‡Œæ²¡æœ‰ï¼Œæ‰€ä»¥æˆ‘å°±æ²¡æœ‰ç”¨è¿™ä¸ªå‡½æ•°äº†)ã€‚åœ¨/*&nbsp;6&nbsp;*/é‡Œæˆ‘ä»¬å…ˆæ‰¾åˆ°IMAGE_DOS_HEADERç»“æ„ï¼Œä»–çš„èµ·å§‹åœ°å€å°±æ˜¯æ˜ åƒçš„åŸºåœ°å€ã€‚/*7*/é€šè¿‡IMAGE_DOS_HEADERç»™å‡ºçš„PEæ–‡ä»¶å¤´çš„åç§»é‡ï¼Œæ‰¾åˆ°IMAGE_NT_HEADERSç»“æ„ã€‚é¡ºè—¤æ‘¸ç“œï¼ŒIMAGE_NT_HEADERSé‡Œçš„OptionalHeaderä¸­çš„DataDirectoryæ•°ç»„é‡Œçš„ç¬¬äºŒä¸ªå…ƒç´ æ­£æ˜¯æŒ‡å‘æˆ‘ä»¬æƒ³è¦çš„IMPORT&nbsp;TABLEçš„åœ°å€ã€‚åœ¨/*9*/ä¸­æˆ‘ä»¬å°†å…¶è½¬åŒ–ä¸ºä¸€ä¸ªIMAGE_IMPORT_DESCRIPTORçš„ç»“æ„æŒ‡é’ˆå­˜å…¥piidä¸­ã€‚<br /><br />æ›¿æ¢çš„APIå‡½æ•°å…¥å£åœ°å€<br />åœ¨/*12*/å’Œ/*13*/ä¸­æˆ‘ä»¬åˆ†åˆ«å–å¾—OriginalFirstThunkå’ŒFirstThunkç»“æ„ï¼Œç”¨äºä»¥åå¾—åˆ°APIå‡½æ•°çš„åç§°å’Œå…¥å£åœ°å€ã€‚/*10*/çš„doå¾ªç¯è®©æˆ‘ä»¬éå†æ¯ä¸€ä¸ªIMAGE_IMPORT_DESCRIPTORç»“æ„ä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºå¼•ç”¨çš„æ¯ä¸ªDLLã€‚åœ¨/*14*/çš„å¾ªç¯ä¸­æˆ‘ä»¬éå†DLLä¸­çš„IMAGE_THUNK_DATAç»“æ„æ¥ä¸€ä¸€æŸ¥è¯¢APIçš„ä¿¡æ¯ã€‚/*16*/ä¸­æˆ‘ä»¬å°†OriginalFirstThunkè½¬æ¢ä¸ºIMAGE_IMPORT_BY_NAMEç»“æ„ç”¨äºè·å¾—APIå‡½æ•°çš„åç§°è¿›è¡Œæ¯”å¯¹ã€‚åœ¨/*18*/æˆ‘ä»¬æ‰¾åˆ°MessageBoxWå‡½æ•°ä¹‹åï¼Œåœ¨/*19*/ä¿å­˜å…¶åŸå§‹å…¥å£åœ°å€ä¾¿äºä»¥åæ¢å¤æ—¶ä½¿ç”¨ã€‚åœ¨/*23*/æˆ‘ä»¬éœ€è¦ç”¨VirtualProtectæ”¹å˜ä¸€ä¸‹å†…å­˜åŒºåŸŸçš„è¯»å†™æ€§ï¼Œå› ä¸ºä¸€èˆ¬åº”ç”¨ç¨‹åºçš„æ˜ åƒéƒ½æ˜¯åªè¯»çš„ï¼Œç›´æ¥å†™å…¥ä¼šé€ æˆä¸€ä¸ªéæ³•è®¿é—®çš„å¼‚å¸¸å‡ºç°ã€‚åœ¨/*25*/æˆ‘ä»¬å†™å…¥è‡ªå·±å‡½æ•°çš„åœ°å€ã€‚<br /><br />è¿™æ ·å°±åŸºæœ¬å®Œæˆä¸€ä¸ªAPIå‡½æ•°çš„é‡å®šå‘ã€‚<br /><br />å…¶ä»–<br />æ¢å¤å‡½æ•°çš„APIå…¥å£åœ°å€ç›¸å¯¹æ¯”è¾ƒç®€å•ã€‚åªè¦æŠŠä¿å­˜çš„å€¼å†å†™å›å»å°±å¯ä»¥äº†ã€‚ä¸Šé¢çš„ç¨‹åºä¸­/*24*/æˆ‘ç”¨APIAddressä¿å­˜äº†å­˜æœ‰MessageBoxWå…¥å£åœ°å€çš„åœ°æ–¹çš„åœ°å€ï¼Œä¾¿äºä»¥åè°ƒç”¨WriteProcessMemoryæ¢å¤æ—¶ä½¿ç”¨ã€‚<br /><br />è·¨è¿›ç¨‹ç†è®º<br />æˆ‘ä»¬è¦ç”¨è‡ªå·±çš„å‡½æ•°æ¥æ›¿ä»£åˆ«äººç¨‹åºé‡Œçš„APIå‡½æ•°ï¼Œä½†æˆ‘ä»¬çš„å‡½æ•°ä¸åˆ«äººçš„ç¨‹åºå¤„äºä¸åŒçš„è¿›ç¨‹ç©ºé—´å†…å•Šã€‚ä¸åŒçš„è¿›ç¨‹ç©ºé—´æ˜¯ä¸èƒ½ç›¸äº’è°ƒç”¨å‡½æ•°çš„ã€‚å› æ­¤æˆ‘ä»¬è¦æƒ³åŠæ³•æŠŠè‡ªå·±çš„å‡½æ•°æ”¾å…¥åˆ«äººçš„è¿›ç¨‹ç©ºé—´å»ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨DLL&nbsp;injectionæŠ€æœ¯äº†ã€‚å¦‚æœä½ å¯¹å¥¹è¿˜ä¸æ˜¯ååˆ†ç†Ÿæ‚‰çš„è¯ï¼Œå»ºè®®çœ‹çœ‹Jeffrey&nbsp;Richterå¤§å¸ˆçš„&lt;&gt;ï¼Œä¹Ÿå¯ä»¥å‚è€ƒé™ˆå®½è¾¾å…ˆç”Ÿçš„&lt;&gt;ã€‚<br /><br />ç®€è€Œè¨€ä¹‹ï¼ŒDLL&nbsp;injectionå°±æ˜¯æƒ³åŠæ³•è®©å¯¹æ–¹çš„è¿›ç¨‹åŠ è½½æˆ‘ä»¬çš„ä¸€ä¸ªDLLç¨‹åºï¼ŒæŠŠéœ€è¦æ›¿æ¢çš„å‡½æ•°æ”¾åœ¨æˆ‘ä»¬è¿™ä¸ªDLLé‡Œã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬çš„å‡½æ•°å°±è¿›å…¥äº†åˆ«äººçš„è¿›ç¨‹ç©ºé—´äº†ã€‚DLL&nbsp;injectionæ–¹æ³•å¾ˆå¤šï¼ŒRichterå¤§å¸ˆåœ¨ä¹¦ä¸­å¯¹å„æ–¹æ³•åˆ©å¼Šæœ‰è¯¦ç»†è§£é‡Šï¼Œé™ˆå®½å¤§å…ˆç”Ÿçš„ä¹¦ä¸­ä¹Ÿæœ‰æ·±å…¥çš„åˆ†æã€‚æˆ‘åœ¨è¿™é‡Œä½¿ç”¨SetWindowsHookExå‡½æ•°æ¥è¾¾åˆ°ç›®çš„ã€‚ä¸»è¦æœ‰è¿™å‡ ä¸ªåŸå› :&nbsp;1,&nbsp;ä¸ç”¨é‡æ–°å¯åŠ¨ç³»ç»Ÿï¼Œè°ƒè¯•æ–¹ä¾¿ã€‚2,&nbsp;å¯ä»¥åˆ©ç”¨æ¶ˆæ¯å¾ªç¯æœºåˆ¶è¿›è¡Œä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„<a href="http://www.qqread.com/z/telecom/hot/index.html" target="_blank">é€šä¿¡</a>ï¼Œå¯ä»¥è¾ƒå¥½çš„æŒæ¡Hookçš„çŠ¶æ€ã€‚ä¾¿äºå®‰è£…ä¸å¸è½½ã€‚<br /><br />SetWindowsHookExä¹‹æ‰€ä»¥èƒ½å®ŒæˆDLL&nbsp;injectionæ˜¯å› ä¸ºå®ƒè¦ç»™ä¸€ä¸ªåº”ç”¨ç¨‹åºæŸä¸ªç¯èŠ‚åŠ ä¸Šä¸€ä¸ªHook,è€ŒHookå°±è¦æœ‰Hook&nbsp;Procedureä¹Ÿå°±æ˜¯Hookå‡½æ•°ã€‚å¦‚æœè¿™ä¸ªHookå‡½æ•°åœ¨ä¸€ä¸ªDLLä¸­ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šæŠŠè¿™ä¸ªDLLåŠ è½½åˆ°SetWindowsHookExçš„ç›®æ ‡è¿›ç¨‹ä¸Šã€‚ä»è€Œä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬DLL&nbsp;injectionçš„ç›®çš„äº†ã€‚å½“ç„¶è¿™é‡Œæˆ‘ä»¬ä¼šç”¨WH_GETMESSAGEçš„Hookè¿›è¡Œinjection,å› ä¸ºè¿™ä¸ªHookå¯ä»¥ç”¨æ¥ç›‘è§†ç›®æ ‡è¿›ç¨‹çš„æ¶ˆæ¯å¾ªç¯æ–¹ä¾¿æˆ‘ä»¬çš„è¿›ç¨‹ä¸ç›®æ ‡è¿›ç¨‹é€šä¿¡ã€‚&nbsp;<br /><br />è·¨è¿›ç¨‹çš„å®ç°å’Œå‡ ç‚¹æ³¨æ„<br />/*&nbsp;DllPart.Dll&nbsp;*/<br />#include&nbsp;<br />#include&nbsp;<br />#include&nbsp;<br />#include&nbsp;<br />typedef&nbsp;(WINAPI&nbsp;*MsgBoxType)(HWND,LPCWSTR,LPCWSTR,UINT);&nbsp;<br />MsgBoxType&nbsp;oldMsg;&nbsp;&nbsp;/*APIåŸå…¥å£åœ°å€*/<br />DWORD&nbsp;APIAddress;&nbsp;/*å­˜å‚¨APIå…¥å£åœ°å€çš„åœ°æ–¹çš„åœ°å€*/<br />int&nbsp;WINAPI&nbsp;&nbsp;MyMessage(HWND&nbsp;hWnd&nbsp;,LPCWSTR&nbsp;M1,LPCWSTR&nbsp;M2,&nbsp;UINT&nbsp;M3)&nbsp;{<br />&nbsp;/*&nbsp;è¿™æ˜¯ç”¨æ¥æ›¿æ¢çš„å‡½æ•°&nbsp;*/<br />&nbsp;return&nbsp;oldMsg(hWnd,buf,M2,MB_OK);<br />}<br />const&nbsp;char&nbsp;szApp[]&nbsp;=&nbsp;&quot;DllPart.dll&quot;;<br />HHOOK&nbsp;hHook;&nbsp;/*Hookçš„å¥æŸ„*/<br />HMODULE&nbsp;hInst;&nbsp;/*DLL&nbsp;æ¨¡å—å¥æŸ„ï¼Œç”¨äºSetWindowsHookExå‡½æ•°*/<br />HWND&nbsp;hTarget;&nbsp;/*ç›®æ ‡çª—å£å¥æŸ„*/<br />/*DLL&nbsp;å…¥å£*/<br />BOOL&nbsp;WINAPI&nbsp;DllMain(HINSTANCE&nbsp;inst,&nbsp;DWORD&nbsp;reason,&nbsp;LPVOID&nbsp;lpvReserved)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;hInst&nbsp;=&nbsp;inst;<br />&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(reason)&nbsp;{<br />&nbsp;case&nbsp;DLL_PROCESS_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*è°ƒè¯•ä¿¡æ¯ï¼Œè¡¨ç¤ºDLLå·²ç»åŠ è½½*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&quot;DLL_PROCESS_ATTACH&quot;,szApp,MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;case&nbsp;DLL_PROCESS_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*è°ƒè¯•ä¿¡æ¯ï¼Œè¡¨ç¤ºDLLå·²ç»å¸è½½*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&quot;DLL_PROCESS_DETACH&quot;,szApp,MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br />}<br />/*æ˜¾ç¤ºGetLastErrorçš„ä¿¡æ¯*/<br />void&nbsp;showerr(const&nbsp;char&nbsp;*m)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;message[255];<br />&nbsp;&nbsp;&nbsp;&nbsp;FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM,0,GetLastError()<br />&nbsp;,MAKELANGID(LANG_NEUTRAL,&nbsp;SUBLANG_DEFAULT),message,255,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,message,m,MB_OK);<br />}<br />//-----------------------<br />void&nbsp;UnHookApi()&nbsp;{<br />&nbsp;/*å¸è½½API&nbsp;Hookç”¨*/<br />}<br />void&nbsp;HookApi()&nbsp;{<br />&nbsp;/*åŠ è½½API&nbsp;HookåŒä¸Šé¢ä»‹ç»çš„å‡½æ•°ä¸€æ ·*/<br />}<br />//-----------------------<br />/*ç”¨äºWH_GETMESSAGEçš„Hook&nbsp;Procedure*/<br />LRESULT&nbsp;CALLBACK&nbsp;GetMsgProc(int&nbsp;nCode,WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)&nbsp;{<br />&nbsp;if&nbsp;(nCode&nbsp;==&nbsp;HC_ACTION)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;*msg&nbsp;=&nbsp;(MSG&nbsp;*)lParam;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg-&gt;message&nbsp;==&nbsp;WM_CHAR)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg-&gt;wParam&nbsp;==&nbsp;'h')&nbsp;HookApi();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg-&gt;wParam&nbsp;==&nbsp;'u')&nbsp;UnHookApi();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CallNextHookEx(hHook,nCode,wParam,lParam);<br />}<br />extern&nbsp;&quot;C&quot;&nbsp;__declspec(dllexport)&nbsp;SetAPIHook(HWND&nbsp;handle)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;ThreadId&nbsp;=&nbsp;GetWindowThreadProcessId(handle,&nbsp;NULL);<br />&nbsp;&nbsp;&nbsp;&nbsp;hTarget&nbsp;=&nbsp;handle;<br />&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;&quot;Enabling&nbsp;CallWndProc&nbsp;Hook&quot;,&nbsp;szApp,&nbsp;MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;hHook&nbsp;=&nbsp;SetWindowsHookEx(WH_GETMESSAGE,GetMsgProc,hInst,ThreadId);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hHook)&nbsp;{<br />&nbsp;MessageBox(NULL,&quot;Hook&nbsp;OK!&quot;,&nbsp;szApp,&nbsp;MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;showerr(&quot;SetWindowsHookEx&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br />extern&nbsp;&quot;C&quot;&nbsp;__declspec(dllexport)&nbsp;UnHookAPIHook()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&nbsp;&quot;Disenabling&nbsp;CallWndProc&nbsp;Hook&quot;,&nbsp;szApp,&nbsp;MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(UnhookWindowsHookEx(hHook))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&quot;UnHook&nbsp;OK!&quot;,&nbsp;szApp,&nbsp;MB_OK);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;showerr(&quot;UnHookWindowsHookEx&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br />åˆ†æ<br />å‡ ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜<br />SetAPIHookå’ŒUnHookAPIHookæ˜¯æˆ‘ä»¬è‡ªå·±è¿›ç¨‹è°ƒç”¨çš„ç”¨æ¥åŠ è½½WH_GETMESSAGE&nbsp;Hookçš„å‡½æ•°ã€‚ç”±äºæˆ‘ä»¬çš„ç¨‹åºè¦ç”¨LoadLibraryåŠ è½½è¿™ä¸ªDllå› æ­¤è¿™ä¸¤ä¸ªå‡½æ•°è¦ç”¨__declspec(dllexport)ä¿®é¥°ï¼Œä½¿å…¶æˆä¸ºå¯¼å‡ºå‡½æ•°ï¼Œæ‰èƒ½è¢«GetAddressProcå‡½æ•°æ‰¾åˆ°ã€‚åŠ ä¸Š&nbsp;extern&nbsp;&quot;C&quot;æ˜¯è®©ç¼–è¯‘å™¨ä½¿ç”¨<a href="http://www.qqread.com/keys/c-language/index.html" target="_blank">Cè¯­è¨€</a>ç¼–ç æ–¹å¼ã€‚å› ä¸ºC++ç¼–è¯‘å™¨ä¼šè¿›è¡ŒDynamic&nbsp;Binding(C++å‡½æ•°é‡è½½çš„å®ç°),å°†å‡½æ•°çš„å‚æ•°ç±»å‹é™„åŠ åˆ°åç§°ä¸Šã€‚æ˜¯å‡½æ•°çš„å¯¼å‡ºåçœ‹èµ·æ¥åƒSetAPIHook@XYTZXä¹‹ç±»çš„,ä¸åˆ©äºGetAddressProcè¿›è¡Œå¼•ç”¨ã€‚å› æ­¤ä½¿ç”¨extern&nbsp;&quot;C&quot;è®©ç¼–è¯‘å™¨ä¸ä½¿ç”¨Dynamic&nbsp;Bindingï¼Œè‡ªç„¶ä½¿ç”¨extern&quot;C&quot;çš„å‡½æ•°ä¹Ÿå°±ä¸èƒ½è¢«é‡è½½äº†ã€‚<br /><br />ä¸è¦å¿˜è®°åœ¨GetMsgProcæœ€åè¦è°ƒç”¨CallNextHookExå‡½æ•°ï¼Œä¿è¯Hooké“¾çš„å®Œæ•´æ€§ã€‚<br /><br />ä¸€å®šè¦åœ¨Hook&nbsp;Procedureä¸­è°ƒç”¨HookApiå’ŒUnHookApiå‡½æ•°ï¼Œå› ä¸ºä¿å­˜APIå…¥å£åœ°å€çš„åœ°æ–¹åœ¨ç›®æ ‡è¿›ç¨‹ä¸­ï¼Œä½ å¿…é¡»åœ¨ç›®æ ‡è¿›ç¨‹çš„è¿›ç¨‹ç©ºé—´å†…å®Œæˆå¸è½½æ“ä½œï¼Œä¸èƒ½åœ¨UnHookAPIHookæˆ–æ˜¯SetAPIHookå‡½æ•°ä¸­è°ƒç”¨ï¼Œå› ä¸ºUnHookAPIHookæ˜¯æˆ‘ä»¬çš„è¿›ç¨‹è°ƒç”¨çš„ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„è¿›ç¨‹ç©ºé—´ä¸­ã€‚åœ¨è¿™é‡Œä½¿ç”¨UnHookApiä¼šé€ æˆä¸€ä¸ªéæ³•è®¿é—®çš„é”™è¯¯ã€‚è€Œä½¿ç”¨HookApiä¼šç»™è‡ªå·±çš„DLLåŠ ä¸ŠAPI&nbsp;Hookã€‚<br /><br />SetWindowsHookExçš„æœ€åå‚æ•°æ˜¯ThreadIdä¸æ˜¯Handle,å› æ­¤è¦é€šè¿‡è°ƒç”¨GetWindowThreadProcessIdè½¬æ¢ä¸€ä¸‹ã€‚&nbsp;<br /><br />åœ¨è·¨è¿›ç¨‹API&nbsp;HOOKæ—¶å¯èƒ½ç”¨åˆ°çš„å…¶ä»–æŠ€æœ¯<br />ä¸»è¿›ç¨‹ä¸ç›®æ ‡è¿›ç¨‹çš„ä¿¡æ¯äº¤äº’å’Œå…±äº«<br />ç”±äºä½¿ç”¨äº†WH_GETMESSAGEé’©å­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Windowsæ¶ˆæ¯æœºåˆ¶å®ç°è¿›ç¨‹é—´é€šè®¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åº”è¯¥ä½¿ç”¨PostThreadMessageæ¥å‘é€è®©WH_GETMESSAGEå¾—åˆ°çš„æ¶ˆæ¯è€Œä¸æ˜¯SendMessageæˆ–è€…PostMessage,å› ä¸ºåä¸¤ä¸ªæ˜¯ç”¨æ¥ç»™çª—å£å‘é€æ¶ˆæ¯çš„ã€‚è€Œæˆ‘ä»¬çš„WH_GETMESSAGEæ˜¯Hookåœ¨çº¿ç¨‹ä¸Šé¢çš„ï¼Œå› æ­¤éœ€ä½¿ç”¨PostThreadMessage.<br /><br />ä¼ é€’ä¸å¤ªå¤§çš„æ•°æ®å¯ä»¥ä½¿ç”¨WM_COPYDATAæ¶ˆæ¯æ¥è¿›è¡Œã€‚åŒæ ·ä¹Ÿåº”è¯¥æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨<a href="http://www.qqread.com/keys/mfc/index.html" target="_blank">MFC</a>çš„çª—å£è¿‡ç¨‹è·å¾—æ¶ˆæ¯å°±éœ€è¦ç”¨SendMessageå‘é€äº†ã€‚WM_COPYDATAçš„ä½¿ç”¨ç›¸å¯¹ç®€å•å¯ä»¥å‚è€ƒMSDNçš„æ–‡æ¡£ã€‚ä¹Ÿå¯ä»¥å‚è€ƒé™„å½•é‡Œçš„ç¨‹åºHook.cppçš„showerrå‡½æ•°éƒ¨åˆ†ã€‚<br /><br />å¦‚æœä¼ é€’è¾ƒå¤§çš„æ•°æ®æˆ–è€…å¸Œæœ›æ•°æ®å…±äº«æ¯”è¾ƒæ–¹ä¾¿å¯ä»¥å¼€è¾Ÿå…±äº«å†…å­˜æ¥è¿›è¡Œæ•°æ®å…±äº«ã€‚è¿™é‡Œç®€å•åˆ†æä¸€ä¸‹ä½¿ç”¨å…±äº«å†…å­˜çš„ä»£ç &nbsp;<br /><br />HANDLE&nbsp;hMap;<br />switch&nbsp;(reason)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_PROCESS_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;/*åˆ›å»º/æ‰“å¼€å…±äº«å†…å­˜åŒºåŸŸ*/<br />&nbsp;&nbsp;&nbsp;&nbsp;hMap&nbsp;=&nbsp;CreateFileMapping((HFILE&nbsp;*)0xFFFFFFFF,NULL,PAGE_READWRITE,0,sizeof(GLOBALDATA),ID_MAP);<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data&nbsp;=&nbsp;(GLOBALDATA*)MapViewOfFile(hMap,FILE_MAP_ALL_ACCESS,0&nbsp;,0&nbsp;,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!pg_data)&nbsp;{<br />&nbsp;MessageBox(NULL,&quot;æ— æ³•å»ºç«‹å…±äº«å†…å­˜ï¼Œç¨‹åºç»ˆæ­¢ï¼&quot;,szApp,MB_OK);<br />&nbsp;if&nbsp;(hMap)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hMap);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hMap&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;hInst&nbsp;=&nbsp;hInst;<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;å…±äº«å†…å­˜æ˜ åƒæ–‡ä»¶&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;DLLè£…è½½ä¸­...&quot;,FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_PROCESS_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pg_data)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile(pg_data);<br />&nbsp;pg_data&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hMap)&nbsp;{<br />&nbsp;CloseHandle(hMap);<br />&nbsp;hMap&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;break;<br />}<br /><br />ä¸Šé¢çš„ä»£ç é€šè¿‡CreateFileMappingå»ºç«‹å…±äº«åŒºåŸŸã€‚å°†å…¶ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸º0xFFFFFFFFä½¿å…¶èƒ½åˆ›å»ºä¸€ä¸ªå†…å­˜å…±äº«åŒºåŸŸè€Œä¸æ˜¯æ–‡ä»¶ã€‚å¹¶æ ‡è®°ä¸ºå¯è¯»å†™çš„(PAGE_READWRITE).å…¶å¤§å°ä¸ºæˆ‘ä»¬å®šä¹‰çš„ç»“æ„ä½“GLOBALDATAçš„å¤§å°ã€‚æœ€åçš„ID_MAPæ˜¯ä¸€ä¸ªç”¨æ¥æ ‡ç¤ºè¿™ä¸ªåŒºåŸŸçš„å­—ç¬¦ä¸²ã€‚æ‰“å¼€æˆ–è€…åˆ›å»ºå®Œå…±äº«åŒºåŸŸåï¼Œæˆ‘ä»¬ç”¨MapViewOfFileæ¥è·å¾—è¿™ä¸ªåŒºåŸŸçš„åœ°å€ã€‚ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨pg_dataæ¥æ“ä½œå…±äº«åŒºåŸŸäº†ã€‚ä¸è¦å¿˜è®°åœ¨DLLé€€å‡ºçš„æ—¶å€™<a href="http://www.qqread.com/security/index.html" target="_blank">å®‰å…¨</a>çš„åˆ é™¤å…±äº«åŒºåŸŸé‡Šæ”¾å†…å­˜ã€‚&nbsp;<br />æ¶ˆæ¯ç­‰å¾…ä¸å®‰å…¨å¸è½½<br />åœ¨æˆ‘ä»¬å¸è½½WH_GETMESSAGEé’©å­ä¹‹å‰å¿…é¡»å…ˆæŠŠç›®æ ‡ç¨‹åºçš„APIè°ƒç”¨æ¢å¤æ­£å¸¸ã€‚æˆ‘ä»¬ä¸èƒ½å†è°ƒç”¨UnHookApiä¹‹åå°±ç«‹åˆ»è°ƒç”¨UnhookWindowsHookEx,å› ä¸ºå¾ˆæœ‰å¯èƒ½UnHookApiè¿˜æ²¡æ¥å¾—æ€¥å®ŒæˆAPIå…¥å£åœ°å€çš„æ¢å¤æ“ä½œï¼ŒWH_GETMESSAGEé’©å­å°±å·²ç»è¢«å¸è½½äº†ã€‚å› æ­¤éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰UnHookApiå®Œæˆäº†æ¢å¤æ“ä½œåœ¨è°ƒç”¨UnhookWindowsHookExã€‚ä»¥é˜²é”™è¯¯å‘ç”Ÿã€‚<br /><br />extern&nbsp;&quot;C&quot;&nbsp;__declspec(dllexport)&nbsp;void&nbsp;UnHookAPIHook()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;/*å‘ç›®æ ‡çº¿ç¨‹å‘é€æ¶ˆæ¯è¿›è¡ŒAPI&nbsp;UNHOOK*/<br />&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idTarget,WM_DISABLEAPIHOOK,(WPARAM)GetCurrentThreadId(),0);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;WM_DISABLEAPIHOOK&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;/*ç­‰å¾…ç›®æ ‡è¿›ç¨‹è¿”å›WM_UNHOOKOKæ¶ˆæ¯ï¼Œç¡®è®¤å¯ä»¥å°†WH_GETMESSAGEçš„HOOKå»æ‰*/<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;Msg;<br />&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMessage(&amp;Msg,NULL,0,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;}while(Msg.message&nbsp;!=&nbsp;&nbsp;WM_UNHOOKOK);<br />&nbsp;&nbsp;&nbsp;&nbsp;UnhookWindowsHookEx(pg_data-&gt;hHook);<br />&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idTarget,WM_DISABLEAPIHOOKOK,(WPARAM)GetCurrentThreadId(),0);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;UnHookWindowsHookEx&quot;);<br />}<br />ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå«æœ‰GetMessageçš„å¾ªç¯æ¥ç­‰å¾…æ¶ˆæ¯çš„åˆ°è¾¾ï¼Œä¸€æ—¦UnHookApiå®Œæˆä»–å°±ä¼šå‘é€WM_UNHOOKOKæ¶ˆæ¯ã€‚ç­‰æˆ‘ä»¬æ¥æ”¶åˆ°æ¶ˆæ¯ç¡®è®¤ä¸€åˆ‡å®‰å…¨äº†åœ¨æ¥å¸è½½WH_GETMESSAGEé’©å­ã€‚&nbsp;<br />å¼„æ¸…æ¶ˆæ¯å¯¹è±¡<br />æˆ‘ä»¬ä¸€å®šè¦æ¸…æ¥šä»£ç æ˜¯åœ¨ä¸»ç¨‹åºè¿›ç¨‹ç©ºé—´ä¸­æ‰§è¡Œçš„è¿˜æ˜¯åœ¨ç›®æ ‡ç¨‹åºè¿›ç¨‹ç©ºé—´ä¸­æ‰§è¡Œçš„ã€‚åƒä¸Šé¢çš„UnHookAPIHookå‡½æ•°å°±æ˜¯é€šè¿‡ä¸»ç¨‹åºè°ƒç”¨çš„ï¼Œå› æ­¤åœ¨ä¸»ç¨‹åºè¿›ç¨‹ç©ºé—´ä¸­æ‰§è¡Œã€‚è¿™æ ·ä¸€æ¥ç”¨æ¥æ¢å¤ç›®æ ‡ç¨‹åºAPIä¿¡æ¯çš„UnHookApiå®Œæˆåå°±åº”è¯¥å‘ä¸»ç¨‹åºå‘é€æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯ç›®æ ‡ç¨‹åºã€‚<br /><br />ç›®æ ‡è¿›ç¨‹åŠ è½½äº†å…¶ä»–DLL<br />å¦‚æœç›®æ ‡è¿›ç¨‹åŠ¨æ€åŠ è½½äº†å…¶ä»–çš„DLLæ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»ç›‘è§†LoadLibraryå‡½æ•°ã€‚ä¿è¯DLLä¸­çš„APIå…¥å£åœ°å€ä¹Ÿè¢«æ­£ç¡®ä¿®æ”¹ã€‚é˜²æ­¢å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»LoadLibraryè·å¾—DLLçš„è·¯å¾„ç”¨äºGetModuleHandleæ¥å–å¾—ä»–çš„ImageBaseçš„åœ°å€ã€‚<br /><br />ä¸çŸ¥é“æ–‡ç« å†™çš„å¦‚ä½•ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤šç»™äº›æ‰¹è¯„æ„è§ã€‚å‘ç°é—®é¢˜æˆ‘é©¬ä¸Šæ”¹æ­£<br />Email:&nbsp;detrox@yang.com.cn<br /><br />å‚è€ƒèµ„æ–™<br />&lt;&gt;,&nbsp;Jeffrey&nbsp;Richter,&nbsp;Microsoft&nbsp;Press<br /><br />&lt;&gt;,é™ˆå®½è¾¾,åä¸­ç§‘å¤§å‡ºç‰ˆç¤¾<br /><br />&lt;&gt;,&nbsp;LUEVELSMEYER<br /><br />&lt;&gt;,&nbsp;Iczelion<br /><br />é™„:è·¨è¿›ç¨‹APIHookçš„ä¾‹å­<br />å…ˆæ‰“å¼€ä¸€ä¸ªè®°äº‹æœ¬ç¨‹åºå¹¶è¾“å…¥å‡ ä¸ªå­—ç¬¦ï¼Œè¿è¡Œä¸‹é¢çš„ç¨‹åºï¼ŒåŠ è½½APIHook.ä¹‹ååœ¨è®°äº‹æœ¬çš„æ–‡ä»¶èœå•ä¸­é€‰æ‹©æ–°å»ºå°±ä¼šçœ‹åˆ°API&nbsp;Hookå°†MessageBoxW&nbsp;å‡½æ•°Hookçš„ç»“æœäº†.<br />ä»£ç åœ¨WinXP&nbsp;SP1&nbsp;+&nbsp;VC6.0æµ‹è¯•æˆåŠŸã€‚<br /><br />ä¸‹è½½æºä»£ç <br /><br />(ç‰¹åˆ«æ„Ÿè°¢è€ç½—çš„ä»£ç ç€è‰²å™¨ï¼Œæ¯”æˆ‘è‡ªå·±é‚£ä¸ªå¥½å¤šäº†)<br /><br />è¿™æ˜¯DLLçš„ç¨‹åºï¼ŒHook.dll<br />#include&nbsp;<br />#include&nbsp;<br />#include&nbsp;<br />#include&nbsp;<br />#include&nbsp;&quot;mydef.h&quot;<br /><br />const&nbsp;char&nbsp;szApp[]&nbsp;=&nbsp;&quot;Hook.dll&quot;;&nbsp;/*åº”ç”¨ç¨‹åºåç§°*/<br />HANDLE&nbsp;hMap;/*åœ¨å…±äº«å†…å­˜æ˜ åƒçš„å¥æŸ„*/<br />GLOBALDATA&nbsp;*pg_data;&nbsp;/*åœ¨å…±äº«å†…å­˜ä¸­çš„å…¨å±€æ•°æ®*/<br />LRESULT&nbsp;CALLBACK&nbsp;GetMsgProc(int,WPARAM,&nbsp;LPARAM);<br /><br />/*æ˜¾ç¤ºGetLastErroræŒ‡å‡ºçš„é”™è¯¯*/<br />void&nbsp;showerr(const&nbsp;char&nbsp;*m,&nbsp;BOOL&nbsp;GetError&nbsp;=&nbsp;TRUE)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;message[127];<br />&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buf[255];<br />&nbsp;&nbsp;&nbsp;&nbsp;COPYDATASTRUCT&nbsp;cds;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GetError)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM,0<br />&nbsp;&nbsp;,GetLastError(),MAKELANGID(LANG_NEUTRAL,&nbsp;SUBLANG_DEFAULT),message,127,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*message&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(GetCurrentThreadId()&nbsp;!=&nbsp;pg_data-&gt;idMain)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buf,&quot;ç›®æ ‡ç¨‹åºç©ºé—´DLL:&nbsp;%-30s&nbsp;[%-40s]&quot;,m,&nbsp;message);<br />&nbsp;&nbsp;&nbsp;&nbsp;else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buf,&quot;ä¸»ç¨‹åºç©ºé—´DLL&nbsp;&nbsp;:&nbsp;%-30s&nbsp;[%-40s]&quot;,m,&nbsp;message);<br />&nbsp;&nbsp;&nbsp;&nbsp;cds.lpData&nbsp;=&nbsp;buf;<br />&nbsp;&nbsp;&nbsp;&nbsp;cds.cbData&nbsp;=&nbsp;sizeof(buf);<br />&nbsp;&nbsp;&nbsp;&nbsp;cds.dwData&nbsp;=&nbsp;0;<br />&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;SendMessage(pg_data-&gt;hWndMain,WM_COPYDATA,(WPARAM)pg_data-&gt;hWndTarget,(LPARAM)&amp;cds);<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;SetLastError(0);<br />}<br />int&nbsp;WINAPI&nbsp;MyMessageBoxW(HWND&nbsp;hWnd&nbsp;,LPCWSTR&nbsp;M1,LPCWSTR&nbsp;M2,&nbsp;UINT&nbsp;M3)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;wchar_t&nbsp;buf[255];<br />&nbsp;&nbsp;&nbsp;&nbsp;swprintf(buf,L&quot;!!è¿™ä¸ªçª—å£çš„APIè¢«Hookäº†!! HWND:&nbsp;0x%08X Message:&nbsp;%s Caption:&nbsp;%s&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,(DWORD&nbsp;*)hWnd<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;M1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;M2);<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;oldAPIFunction(hWnd,buf,M2,MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;pg_data-&gt;oldAPIFunction(hWnd,M1,M2,M3);<br />}<br /><br />/*DLL&nbsp;å…¥å£å‡½æ•°*/<br />BOOL&nbsp;WINAPI&nbsp;DllMain(HINSTANCE&nbsp;hInst,&nbsp;DWORD&nbsp;reason,LPVOID&nbsp;lpvReserved)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(reason)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_PROCESS_ATTACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*åˆ›å»º/æ‰“å¼€å…±äº«å†…å­˜åŒºåŸŸ*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hMap&nbsp;=&nbsp;CreateFileMapping((HFILE&nbsp;*)0xFFFFFFFF,NULL,PAGE_READWRITE,0,sizeof(GLOBALDATA),ID_MAP);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg_data&nbsp;=&nbsp;(GLOBALDATA*)MapViewOfFile(hMap,FILE_MAP_ALL_ACCESS,0&nbsp;,0&nbsp;,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!pg_data)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(NULL,&quot;æ— æ³•å»ºç«‹å…±äº«å†…å­˜ï¼Œç¨‹åºç»ˆæ­¢ï¼&quot;,szApp,MB_OK);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hMap)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hMap);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hMap&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;hInst&nbsp;=&nbsp;hInst;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;å…±äº«å†…å­˜æ˜ åƒæ–‡ä»¶&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;DLLè£…è½½ä¸­...&quot;,FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;DLL_PROCESS_DETACH:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;DLLå¸è½½ä¸­...&quot;,FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pg_data)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnmapViewOfFile(pg_data);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg_data&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hMap)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CloseHandle(hMap);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hMap&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;<br />}<br />/*å¸è½½API&nbsp;Hook*/<br />void&nbsp;UnHookApi()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;written&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;oldaddrAPIFunction&nbsp;=&nbsp;(DWORD)pg_data-&gt;oldAPIFunction;<br />&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory(GetCurrentProcess(),(DWORD&nbsp;*)pg_data-&gt;addrAPIEntryPoint<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&amp;oldaddrAPIFunction,sizeof(DWORD),&nbsp;&amp;written);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;WriteProcessMemory&nbsp;on&nbsp;UnHook&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;/*å‘ä¸»çº¿ç¨‹å‘é€&nbsp;API&nbsp;UNHOOK&nbsp;å¤„ç†å®Œæ¯•çš„æ¶ˆæ¯*/<br />&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idMain,WM_UNHOOKOK,0,0);<br />}<br /><br />/*åŠ è½½API&nbsp;Hook*/<br />void&nbsp;HookApi(const&nbsp;char*&nbsp;szApiName,&nbsp;tAPIFunction&nbsp;newAddr,&nbsp;DWORD&nbsp;ImageBase)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;/*è¿™æ®µä»£ç è¯·å‚è€ƒæ–‡ç« ä¸­çš„åˆ†æ*/<br />&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_DOS_HEADER&nbsp;*pidh;<br />&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_NT_HEADERS&nbsp;*pinh;<br />&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_DATA_DIRECTORY&nbsp;*pSymbolTable;<br />&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_IMPORT_DESCRIPTOR&nbsp;*piid;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;pidh&nbsp;=&nbsp;(IMAGE_DOS_HEADER&nbsp;*)ImageBase;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;pinh&nbsp;=&nbsp;(IMAGE_NT_HEADERS&nbsp;*)((DWORD)ImageBase&nbsp;+&nbsp;pidh-&gt;e_lfanew);<br />&nbsp;&nbsp;&nbsp;&nbsp;pSymbolTable&nbsp;=&nbsp;&amp;pinh-&gt;OptionalHeader.DataDirectory[1];<br />&nbsp;&nbsp;&nbsp;&nbsp;piid&nbsp;=(IMAGE_IMPORT_DESCRIPTOR&nbsp;*)((DWORD)ImageBase&nbsp;+&nbsp;&nbsp;pSymbolTable-&gt;VirtualAddress);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_THUNK_DATA&nbsp;*pitd_org,*pitd_1st;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pitd_org&nbsp;=&nbsp;(IMAGE_THUNK_DATA&nbsp;*)((DWORD)ImageBase&nbsp;+&nbsp;piid-&gt;OriginalFirstThunk);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pitd_1st&nbsp;=&nbsp;(IMAGE_THUNK_DATA&nbsp;*)((DWORD)ImageBase&nbsp;+&nbsp;piid-&gt;FirstThunk);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE_IMPORT_BY_NAME&nbsp;*piibn;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;piibn&nbsp;=&nbsp;(IMAGE_IMPORT_BY_NAME&nbsp;*)((DWORD)ImageBase&nbsp;+&nbsp;&nbsp;*((DWORD&nbsp;*)pitd_org));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROC&nbsp;*pAPIFunction&nbsp;=&nbsp;(PROC&nbsp;*)(pitd_1st-&gt;u1.Function);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!strcmp(szApiName,(char&nbsp;*)piibn-&gt;Name))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;addrNewAPIFunction&nbsp;=&nbsp;(DWORD)MyMessageBoxW;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;written&nbsp;=&nbsp;0;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;oldAccess;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;oldAPIFunction&nbsp;=&nbsp;(tAPIFunction)(pAPIFunction);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*Change&nbsp;Memeory&nbsp;State*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VirtualProtect(&amp;pitd_1st-&gt;u1.Function,sizeof(DWORD),PAGE_WRITECOPY,&amp;oldAccess);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;VirtualProtect&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;addrAPIEntryPoint&nbsp;=&nbsp;(DWORD)&amp;pitd_1st-&gt;u1.Function;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*Write&nbsp;Process&nbsp;Memory*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteProcessMemory(GetCurrentProcess(),&amp;pitd_1st-&gt;u1.Function<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&amp;addrNewAPIFunction,sizeof(DWORD),&nbsp;&amp;written);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;WriteProcessMemory&nbsp;on&nbsp;Hook&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pitd_org++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pitd_1st++;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while&nbsp;(pitd_1st-&gt;u1.Function);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;piid++;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;while&nbsp;(piid-&gt;FirstThunk&nbsp;+&nbsp;piid-&gt;Characteristics&nbsp;<br />&nbsp;+&nbsp;piid-&gt;ForwarderChain&nbsp;+&nbsp;piid-&gt;Name&nbsp;+&nbsp;piid-&gt;TimeDateStamp);<br />}<br /><br />//-----------------------<br />extern&nbsp;&quot;C&quot;&nbsp;__declspec(dllexport)&nbsp;BOOL&nbsp;SetAPIHook(HWND&nbsp;_target)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;hHook&nbsp;=&nbsp;SetWindowsHookEx(WH_GETMESSAGE,GetMsgProc,pg_data-&gt;hInst,pg_data-&gt;idTarget);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;SetWindowsHookEx&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;/*å‘ç›®æ ‡çº¿ç¨‹å‘é€æ¶ˆæ¯è¿›è¡ŒAPI&nbsp;HOOK*/<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(pg_data-&gt;hHook)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idTarget,WM_ENABLEAPIHOOK,0,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;FALSE;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;WM_ENABLEAPIHOOK&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;TRUE;<br />}<br /><br />extern&nbsp;&quot;C&quot;&nbsp;__declspec(dllexport)&nbsp;void&nbsp;UnHookAPIHook()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;/*å‘ç›®æ ‡çº¿ç¨‹å‘é€æ¶ˆæ¯è¿›è¡ŒAPI&nbsp;UNHOOK*/<br />&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idTarget,WM_DISABLEAPIHOOK,(WPARAM)GetCurrentThreadId(),0);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;WM_DISABLEAPIHOOK&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;/*ç­‰å¾…ç›®æ ‡è¿›ç¨‹è¿”å›WM_UNHOOKOKæ¶ˆæ¯ï¼Œç¡®è®¤å¯ä»¥å°†WH_GETMESSAGEçš„HOOKå»æ‰*/<br />&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;Msg;<br />&nbsp;&nbsp;&nbsp;&nbsp;do&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetMessage(&amp;Msg,NULL,0,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;}while(Msg.message&nbsp;!=&nbsp;&nbsp;WM_UNHOOKOK);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;UnhookWindowsHookEx(pg_data-&gt;hHook);<br />&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idTarget,WM_DISABLEAPIHOOKOK,(WPARAM)GetCurrentThreadId(),0);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;UnHookWindowsHookEx&quot;);<br />}<br /><br />LRESULT&nbsp;CALLBACK&nbsp;GetMsgProc(int&nbsp;nCode,WPARAM&nbsp;wParam,&nbsp;LPARAM&nbsp;lParam)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(nCode&nbsp;==&nbsp;HC_ACTION)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MSG&nbsp;*msg&nbsp;=&nbsp;(MSG&nbsp;*)lParam;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg-&gt;message&nbsp;==&nbsp;WM_ENABLEAPIHOOK)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HookApi(&quot;MessageBoxW&quot;,MyMessageBoxW,(DWORD)GetModuleHandle(NULL));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg-&gt;message&nbsp;==&nbsp;WM_DISABLEAPIHOOK)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnHookApi();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg-&gt;message&nbsp;==&nbsp;WM_DESTROY)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;ç›®æ ‡è¿›ç¨‹é€€å‡º!&quot;,FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CallNextHookEx(pg_data-&gt;hHook,nCode,wParam,lParam);<br />}<br />ã€€<br />è¿™ä¸ªæ˜¯ä¸»ç¨‹åºçš„å…³é”®éƒ¨åˆ†&nbsp;HookGui.cpp<br />ç”¨MFCå»ºç«‹ä¸€ä¸ªçª—å£ç¨‹åºï¼ŒåŒ…å«ä¸¤ä¸ªæŒ‰é’®å’Œä¸€ä¸ªListBox<br /><br />typedef&nbsp;void&nbsp;(*PUnHookAPIHook)();<br />typedef&nbsp;BOOL&nbsp;(*PSetAPIHook)(HWND);<br />HMODULE&nbsp;hDll&nbsp;=&nbsp;NULL;<br />HWND&nbsp;hNotePad&nbsp;=&nbsp;NULL;<br />PSetAPIHook&nbsp;SetAPIHook;<br />PUnHookAPIHook&nbsp;UnHookAPIHook;<br />GLOBALDATA&nbsp;*pg_data;&nbsp;/*åœ¨å…±äº«å†…å­˜ä¸­çš„å…¨å±€æ•°æ®*/<br />HANDLE&nbsp;hMap;&nbsp;/*åœ¨å…±äº«å†…å­˜æ˜ åƒçš„å¥æŸ„*/<br />int&nbsp;CHookGUIDlg::showerr(const&nbsp;char*&nbsp;m)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;message[127];<br />&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buf[255];<br />&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;errId&nbsp;=&nbsp;GetLastError();<br />&nbsp;&nbsp;&nbsp;&nbsp;FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM,0<br />&nbsp;,errId,MAKELANGID(LANG_NEUTRAL,&nbsp;SUBLANG_DEFAULT),message,127,&nbsp;0);<br />&nbsp;&nbsp;&nbsp;&nbsp;sprintf(buf,&quot;ä¸»ç¨‹åº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;%-30s&nbsp;[%-40s] &quot;,m,&nbsp;message);<br />&nbsp;&nbsp;&nbsp;&nbsp;c_List1.InsertString(c_List1.GetCount(),buf);<br />&nbsp;&nbsp;&nbsp;&nbsp;UpdateData(FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;errId;<br />}<br /><br />void&nbsp;CHookGUIDlg::OnSetapihook()&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;Add&nbsp;your&nbsp;control&nbsp;notification&nbsp;handler&nbsp;code&nbsp;here<br />&nbsp;&nbsp;&nbsp;&nbsp;hDll&nbsp;=&nbsp;LoadLibrary(&quot;Hook.dll&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;LoadLibrary&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;hMap&nbsp;=&nbsp;OpenFileMapping(FILE_MAP_ALL_ACCESS,false,ID_MAP);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;OpenFileMapping&quot;);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data&nbsp;=&nbsp;(GLOBALDATA&nbsp;*)MapViewOfFile(hMap,FILE_MAP_ALL_ACCESS,0,0,0);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;MapViewOfFile&quot;);&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!pg_data)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(&quot;ä¸èƒ½æ‰“å¼€å…±äº«å†…å­˜ç¨‹åºç»ˆæ­¢!&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;SetAPIHook&nbsp;=&nbsp;(PSetAPIHook)GetProcAddress(hDll,&quot;SetAPIHook&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;GetProcAddress-SetAPIHOOK&quot;);<br />&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;hWndTarget&nbsp;=&nbsp;::FindWindow(&quot;NotePad&quot;,NULL);<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;hWndMain&nbsp;=&nbsp;m_hWnd;<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;idMain&nbsp;=&nbsp;GetWindowThreadProcessId(m_hWnd,NULL);<br />&nbsp;&nbsp;&nbsp;&nbsp;pg_data-&gt;idTarget&nbsp;=&nbsp;GetWindowThreadProcessId(pg_data-&gt;hWndTarget,NULL);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!showerr(&quot;FindWindow&quot;))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(SetAPIHook)&nbsp;{&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(SetAPIHook(hNotePad))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostThreadMessage(pg_data-&gt;idTarget<br />&nbsp;&nbsp;&nbsp;,&nbsp;WM_SETCALLERID,(LPARAM)GetCurrentThreadId(),0);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(&quot;SetWindowHookExæ—¶å‡ºé”™ï¼Œç¨‹åºç»ˆæ­¢ï¼&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(&quot;æ— æ³•å–å¾—SetAPIHookå‡½æ•°ï¼ç¨‹åºç»ˆæ­¢ï¼&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(&quot;å†…å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°NOTEPAD.EXE&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;c_SetApiHook.EnableWindow(FALSE);<br />&nbsp;&nbsp;&nbsp;&nbsp;c_UnsetApiHook.EnableWindow();<br />}<br /><br />void&nbsp;CHookGUIDlg::OnUnsetapihook()&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;Add&nbsp;your&nbsp;control&nbsp;notification&nbsp;handler&nbsp;code&nbsp;here<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hDll)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(&nbsp;!IsWindow(pg_data-&gt;hWndTarget))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(&quot;ç›®æ ‡è¿›ç¨‹ä¸åœ¨å†…å­˜ä¸­&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnHookAPIHook&nbsp;=&nbsp;(PUnHookAPIHook)GetProcAddress(hDll,&quot;UnHookAPIHook&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;GetProcAddress-UnHookAPIHook&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(UnHookAPIHook)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UnHookAPIHook();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FreeLibrary(hDll);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showerr(&quot;FreeLibrary&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hDll&nbsp;=&nbsp;NULL;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MessageBox(&quot;è¯·å…ˆåŠ è½½DLL&quot;);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;c_SetApiHook.EnableWindow();<br />&nbsp;&nbsp;&nbsp;&nbsp;c_UnsetApiHook.EnableWindow(FALSE);<br />}<br /><br />void&nbsp;CHookGUIDlg::OnOK()&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;Add&nbsp;extra&nbsp;validation&nbsp;here<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(hDll)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnUnsetapihook();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;CDialog::OnOK();<br />}<br /><br />BOOL&nbsp;CHookGUIDlg::OnCopyData(CWnd*&nbsp;pWnd,&nbsp;COPYDATASTRUCT*&nbsp;pCopyDataStruct)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;TODO:&nbsp;Add&nbsp;your&nbsp;message&nbsp;handler&nbsp;code&nbsp;here&nbsp;and/or&nbsp;call&nbsp;default<br />&nbsp;&nbsp;&nbsp;&nbsp;c_List1.InsertString(c_List1.GetCount(),(char&nbsp;*)pCopyDataStruct-&gt;lpData);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;CDialog::OnCopyData(pWnd,&nbsp;pCopyDataStruct);<br /></div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2007/10/08/53-dll%E5%B8%B8%E8%AF%86/">dllå¸¸è¯†</a><a class="next" href="/2007/10/08/51-%E6%B5%85%E8%B0%88%E6%98%BE%20ipqq%20%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%20%E9%99%84%E6%98%BE%20ipqq%E5%8E%9F%E7%90%86/">æµ…è°ˆæ˜¾ ipqq å‘å±•å†ç¨‹ é™„æ˜¾ ipqqåŸç†</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://anthoney.github.io"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/img/avatar.png"/></a><p>To be a better man.</p><a class="info-icon" href="https://twitter.com/yontaw" title="Twitter" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:admin@from2.net" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/anthoney" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GIS/">GIS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E6%96%87%E5%9C%B0%E7%90%86/">äººæ–‡åœ°ç†</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%83%E5%96%9D%E7%8E%A9%E4%B9%90/">åƒå–ç©ä¹</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%96%E8%AF%AD/">å¤–è¯­</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BD%B1%E9%9F%B3%E5%9B%BE%E5%BD%A2/">å½±éŸ³å›¾å½¢</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BF%83%E8%B7%AF/">å¿ƒè·¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%B0%88/">æ‚è°ˆ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E4%BB%B6%E6%8A%80%E6%9C%AF/">è½¯ä»¶æŠ€æœ¯</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%A3%9E%E8%A1%8C%E6%A2%A6%E6%83%B3/">é£è¡Œæ¢¦æƒ³</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/09/10/456-%E7%A9%BA%E9%97%B4%E5%88%B0%E6%9C%9F%E6%8D%A2/">ç”¨äº†17å¹´çš„åŸŸåç©ºé—´åˆ°æœŸäº†ï¼Œæ¢äº†ä¸€ä¸ªæ–°çš„</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/09/30/455-FlexNet%20lmtools%20license%20vitual%20adapter%20Revit%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1/">FlexNet lmtools license vitual adapter Revité…ç½®è™šæ‹Ÿç½‘å¡</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/08/454-%E6%88%BF%E5%B1%8B%E5%9D%90%E5%90%91%E4%BB%A5%E4%BB%80%E4%B9%88%E4%B8%BA%E5%87%86%20%E6%88%BF%E5%B1%8B%E5%9D%90%E5%90%91%E6%80%8E%E4%B9%88%E7%9C%8B/">æˆ¿å±‹åå‘ä»¥ä»€ä¹ˆä¸ºå‡† æˆ¿å±‹åå‘æ€ä¹ˆçœ‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/12/453-FME%20Desktop%202021%20for%20Mac%E5%AE%89%E8%A3%85%E8%B8%A9%E5%9D%91%E6%95%99%E7%A8%8B/">FME Desktop 2021 for Macå®‰è£…è¸©å‘æ•™ç¨‹</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/29/452-%E4%BF%9D%E5%8F%B7google%20voice%E9%99%84%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE/">ä¿å·google voiceé™„ä½¿ç”¨å»ºè®®</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/14/451-5G%20Wifi%20Router%20Band%20Channel%20limit%E4%BF%AE%E6%94%B95GWIFI%E8%B7%AF%E7%94%B1%E4%B8%AD%E5%9B%BD%E9%A2%91%E6%AE%B5%E9%99%90%E5%88%B6/">5G Wifi Router Band Channel limitä¿®æ”¹5GWIFIè·¯ç”±ä¸­å›½é¢‘æ®µé™åˆ¶</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/22/450-%E8%80%81%E6%AC%BEiPhone%E5%8F%98%E6%85%A2%E5%8D%A1%E9%A1%BF%E6%8E%89%E5%B8%A7%E5%8F%91%E7%83%AD%E5%88%87%E6%8D%A2%E8%BF%9F%E7%BC%93%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E5%88%86%E4%BA%AB/">è€æ¬¾iPhoneå˜æ…¢å¡é¡¿æ‰å¸§å‘çƒ­åˆ‡æ¢è¿Ÿç¼“è§£å†³æ–¹æ³•åˆ†äº«</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/13/449-python%E4%B8%AD%E6%96%87%E5%AD%97%E7%AC%A6%E4%B9%B1%E7%A0%81%E8%A7%A3%E5%86%B3%E5%81%8F%E6%96%B9/">pythonä¸­æ–‡å­—ç¬¦ä¹±ç è§£å†³åæ–¹</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/06/02/448-Python%20opencv%20error%20215%20imshow%20%E9%97%AE%E9%A2%98/">Python opencv error 215 imshow é—®é¢˜</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/04/04/447-python%20faild_install_package%20%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">python faild_install_package æŠ¥é”™è§£å†³åŠæ³•</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2023 <a href="/." rel="nofollow">From to Earth.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>